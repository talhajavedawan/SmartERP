<div class="button-space">
  <!-- Close Button -->
  <button
    type="button"
    class="btn-close close-button"
    aria-label="Close"
    (click)="onCancel()"
  ></button>

  <div class="card-body">
    <form [formGroup]="zoneForm" (ngSubmit)="onSubmit()" class="row g-4">
      <!-- =================== HEADER =================== -->
      <h5 class="section-title mt-2 mb-3">
        <i class="bi bi-globe text-primary me-2"></i>
        {{ isEdit ? "Update Zone" : "Add New Zone" }}
      </h5>

      <!-- =================== ZONE INFO =================== -->
      <div class="row g-3 mt-1">
        <!-- ðŸ·ï¸ Zone Name -->
        <div class="col-md-6">
          <label class="form-label">
            Zone Name <span class="text-danger">*</span>
          </label>
          <input
            type="text"
            class="form-control"
            placeholder="Enter zone name"
            formControlName="zoneName"
            autocomplete="off"
          />
          <div
            *ngIf="zoneForm.get('zoneName')?.invalid && zoneForm.get('zoneName')?.touched"
            class="text-danger small"
          >
            Please enter a valid zone name.
          </div>
        </div>

        <!-- ðŸŒ Countries Dropdown -->
        <div class="col-md-6">
          <label class="form-label">
            Countries <span class="text-danger">*</span>
          </label>

          <mat-form-field appearance="outline" class="w-100">
            <mat-select
              formControlName="selectedCountries"
              multiple
              panelClass="custom-select-panel"
              placeholder="Select one or more countries"
            >
              <!-- âœ… Unselect All -->
              <mat-option (click)="clearAllCountries()" class="text-danger">
                âœ– Unselect All
              </mat-option>

              <!-- âœ… Search Field -->
              <mat-option>
                <ngx-mat-select-search
                  [formControl]="countryFilter"
                  [placeholderLabel]="'Search countries...'"
                  [noEntriesFoundLabel]="'No countries found'"
                ></ngx-mat-select-search>
              </mat-option>

              <!-- âœ… Country List -->
              <mat-option
                *ngFor="let country of filteredCountries"
                [value]="country.id"
              >
                {{ country.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <div
            *ngIf="
              zoneForm.get('selectedCountries')?.invalid &&
              zoneForm.get('selectedCountries')?.touched
            "
            class="text-danger small"
          >
            Please select at least one country.
          </div>
        </div>
      </div>

      <!-- ðŸŒ Global error -->
      <div *ngIf="errorMessage" class="alert alert-danger mt-3" role="alert">
        <i class="bi bi-exclamation-circle-fill me-2"></i>{{ errorMessage }}
      </div>
    </form>
  </div>
</div>

<!-- =================== FOOTER BAR =================== -->
<div
  class="footer-bar"
  (click)="onSubmit()"
  [class.disabled]="zoneForm.invalid || isLoading"
>
  <span *ngIf="zoneForm.valid && !isLoading">
    <i class="bi bi-save me-2"></i>
    {{ isEdit ? "Update Zone" : "Save Zone" }}
  </span>

  <span *ngIf="isLoading">
    <span class="spinner-border spinner-border-sm me-2"></span>
    Saving...
  </span>

  <span *ngIf="zoneForm.invalid && !isLoading" class="opacity-75">
    <i class="bi bi-exclamation-triangle me-2"></i>
    Please fill all required fields
  </span>
</div>
