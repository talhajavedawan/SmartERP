<div class="button-space">
  <!-- Close button -->
  <button
    type="button"
    class="btn-close close-button"
    aria-label="Close"
    (click)="closeModal()"
  ></button>

  <form [formGroup]="customerForm">
    <nz-tabset [(nzSelectedIndex)]="selectedTabIndex">
      <!-- =================== CUSTOMER INFORMATION =================== -->
      <nz-tab nzTitle="Customer Information">
        <div class="tab-content">
          <h5 class="section-title">
            <i class="bi bi-building-fill me-2 text-primary"></i> Company
            Details
          </h5>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">
                Company Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="companyName"
                placeholder="Enter Company Name"
                [class.is-invalid]="
                  customerForm.get('companyName')?.invalid &&
                  customerForm.get('companyName')?.touched
                "
              />
              @if (customerForm.get('companyName')?.invalid &&
              customerForm.get('companyName')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid Company Name
              </div>
              }
            </div>
            <div class="col-md-4">
              <label class="form-label">
                Industry Type <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="industryTypeId"
                [class.is-invalid]="
                  customerForm.get('industryTypeId')?.invalid &&
                  customerForm.get('industryTypeId')?.touched
                "
              >
                <option value="">Select Industry</option>
                @for (industry of industries; track industry.id) {
                <option [value]="industry.id">
                  {{ industry.industryTypeName }}
                </option>
                }
              </select>
              @if (customerForm.get('industryTypeId')?.invalid &&
              customerForm.get('industryTypeId')?.touched) {
              <div class="invalid-feedback">Industry Type is required</div>
              }
            </div>
            <div class="col-md-4">
              <label class="form-label">
                Business Type <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="businessTypeId"
                [class.is-invalid]="
                  customerForm.get('businessTypeId')?.invalid &&
                  customerForm.get('businessTypeId')?.touched
                "
              >
                <option value="">Select Business Type</option>
                @for (business of businessTypes; track business.id) {
                <option [value]="business.id">
                  {{ business.businessTypeName }}
                </option>
                }
              </select>
              @if (customerForm.get('businessTypeId')?.invalid &&
              customerForm.get('businessTypeId')?.touched) {
              <div class="invalid-feedback">Business Type is required</div>
              }
            </div>
          </div>

          <!-- Metadata Display -->
          @if (customerId) {
          <div class="row g-3 mt-2">
            <div class="col-md-3">
              <label class="form-label">Created By</label>
              <input
                type="text"
                class="form-control"
                [value]="customerForm.get('createdByName')?.value || '-'"
                readonly
              />
            </div>
            <div class="col-md-3">
              <label class="form-label">Created Date</label>
              <input
                type="text"
                class="form-control"
                [value]="
                  customerForm.get('createdDate')?.value
                    ? formatPKTDate(customerForm.get('createdDate')?.value)
                    : '-'
                "
                readonly
              />
            </div>
            <div class="col-md-3">
              <label class="form-label">Last Modified By</label>
              <input
                type="text"
                class="form-control"
                [value]="customerForm.get('lastModifiedByName')?.value || '-'"
                readonly
              />
            </div>
            <div class="col-md-3">
              <label class="form-label">Last Modified</label>
              <input
                type="text"
                class="form-control"
                [value]="
                  customerForm.get('lastModified')?.value
                    ? formatPKTDate(customerForm.get('lastModified')?.value)
                    : '-'
                "
                readonly
              />
            </div>
          </div>
          }

          <h5 class="section-title mt-4">
            <i class="bi bi-person-fill me-2 text-primary"></i> Contact Person
          </h5>
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">
                First Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="firstName"
                placeholder="Enter First Name"
                [class.is-invalid]="
                  customerForm.get('firstName')?.invalid &&
                  customerForm.get('firstName')?.touched
                "
              />
              @if (customerForm.get('firstName')?.invalid &&
              customerForm.get('firstName')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid First Name
              </div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                Last Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="lastName"
                placeholder="Enter Last Name"
                [class.is-invalid]="
                  customerForm.get('lastName')?.invalid &&
                  customerForm.get('lastName')?.touched
                "
              />
              @if (customerForm.get('lastName')?.invalid &&
              customerForm.get('lastName')?.touched) {
              <div class="invalid-feedback">Please enter a valid Last Name</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                formControlName="email"
                placeholder="Enter Email"
                [class.is-invalid]="
                  customerForm.get('email')?.invalid &&
                  customerForm.get('email')?.touched
                "
              />
              @if (customerForm.get('email')?.invalid &&
              customerForm.get('email')?.touched) {
              <div class="invalid-feedback">Please enter a valid Email</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">Phone Number</label>
              <input
                type="text"
                class="form-control"
                formControlName="phoneNumber"
                placeholder="Enter Phone Number"
                [class.is-invalid]="
                  customerForm.get('phoneNumber')?.invalid &&
                  customerForm.get('phoneNumber')?.touched
                "
              />
              @if (customerForm.get('phoneNumber')?.invalid &&
              customerForm.get('phoneNumber')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid Phone Number
              </div>
              }
            </div>
          </div>
          <div class="form-check mt-3">
            <div class="form-check form-switch">
              <input
                type="checkbox"
                class="form-check-input"
                formControlName="isActive"
                id="isActive"
              />
              <label for="isActive" class="form-check-label">Active</label>
            </div>
          </div>
        </div>
      </nz-tab>

      <!-- =================== ADDRESSES =================== -->
      <nz-tab nzTitle="Addresses">
        <div class="tab-content">
          <h5 class="section-title">
            <i class="bi bi-house-fill me-2 text-primary"></i> Billing Address
          </h5>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">
                Address Line 1 <span class="text-danger">*</span>
              </label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="billingAddressLine1"
                [class.is-invalid]="
                  customerForm.get('billingAddressLine1')?.invalid &&
                  customerForm.get('billingAddressLine1')?.touched
                "
              ></textarea>
              @if (customerForm.get('billingAddressLine1')?.invalid &&
              customerForm.get('billingAddressLine1')?.touched) {
              <div class="invalid-feedback">
                Billing Address Line 1 is required
              </div>
              }
            </div>
            <div class="col-md-4">
              <label class="form-label">Address Line 2</label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="billingAddressLine2"
              ></textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label">
                Zip Code <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="billingZipCode"
                placeholder="Enter Zip Code"
                [class.is-invalid]="
                  customerForm.get('billingZipCode')?.invalid &&
                  customerForm.get('billingZipCode')?.touched
                "
              />
              @if (customerForm.get('billingZipCode')?.invalid &&
              customerForm.get('billingZipCode')?.touched) {
              <div class="invalid-feedback">Please enter a valid Zip Code</div>
              }
            </div>
          </div>
          <div class="row g-3 mt-2">
            <div class="col-md-3">
              <label class="form-label">
                Zone <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="billingZoneId"
                [class.is-invalid]="
                  customerForm.get('billingZoneId')?.invalid &&
                  customerForm.get('billingZoneId')?.touched
                "
              >
                <option value="">Select Zone</option>
                @for (z of zones; track z.id) {
                <option [value]="z.id">{{ z.name }}</option>
                }
              </select>
              @if (customerForm.get('billingZoneId')?.invalid &&
              customerForm.get('billingZoneId')?.touched) {
              <div class="invalid-feedback">Zone is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                Country <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="billingCountryId"
                [class.is-invalid]="
                  customerForm.get('billingCountryId')?.invalid &&
                  customerForm.get('billingCountryId')?.touched
                "
              >
                <option value="">Select Country</option>
                @for (country of billingCountries; track country.id) {
                <option [value]="country.id">{{ country.name }}</option>
                }
              </select>
              @if (customerForm.get('billingCountryId')?.invalid &&
              customerForm.get('billingCountryId')?.touched) {
              <div class="invalid-feedback">Country is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                State <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="billingStateId"
                [class.is-invalid]="
                  customerForm.get('billingStateId')?.invalid &&
                  customerForm.get('billingStateId')?.touched
                "
              >
                <option value="">Select State</option>
                @for (s of billingStates; track s.id) {
                <option [value]="s.id">{{ s.name }}</option>
                }
              </select>
              @if (customerForm.get('billingStateId')?.invalid &&
              customerForm.get('billingStateId')?.touched) {
              <div class="invalid-feedback">State is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                City <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="billingCityId"
                [class.is-invalid]="
                  customerForm.get('billingCityId')?.invalid &&
                  customerForm.get('billingCityId')?.touched
                "
              >
                <option value="">Select City</option>
                @for (c of billingCities; track c.id) {
                <option [value]="c.id">{{ c.name }}</option>
                }
              </select>
              @if (customerForm.get('billingCityId')?.invalid &&
              customerForm.get('billingCityId')?.touched) {
              <div class="invalid-feedback">City is required</div>
              }
            </div>
          </div>

          <h5 class="section-title mt-4">
            <i class="bi bi-truck me-2 text-primary"></i> Shipping Address
          </h5>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">
                Address Line 1 <span class="text-danger">*</span>
              </label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="shippingAddressLine1"
                [class.is-invalid]="
                  customerForm.get('shippingAddressLine1')?.invalid &&
                  customerForm.get('shippingAddressLine1')?.touched
                "
              ></textarea>
              @if (customerForm.get('shippingAddressLine1')?.invalid &&
              customerForm.get('shippingAddressLine1')?.touched) {
              <div class="invalid-feedback">
                Shipping Address Line 1 is required
              </div>
              }
            </div>
            <div class="col-md-4">
              <label class="form-label">Address Line 2</label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="shippingAddressLine2"
              ></textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label">
                Zip Code <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="shippingZipCode"
                placeholder="Enter Zip Code"
                [class.is-invalid]="
                  customerForm.get('shippingZipCode')?.invalid &&
                  customerForm.get('shippingZipCode')?.touched
                "
              />
              @if (customerForm.get('shippingZipCode')?.invalid &&
              customerForm.get('shippingZipCode')?.touched) {
              <div class="invalid-feedback">Please enter a valid Zip Code</div>
              }
            </div>
          </div>
          <div class="row g-3 mt-2">
            <div class="col-md-3">
              <label class="form-label">
                Zone <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="shippingZoneId"
                [class.is-invalid]="
                  customerForm.get('shippingZoneId')?.invalid &&
                  customerForm.get('shippingZoneId')?.touched
                "
              >
                <option value="">Select Zone</option>
                @for (z of zones; track z.id) {
                <option [value]="z.id">{{ z.name }}</option>
                }
              </select>
              @if (customerForm.get('shippingZoneId')?.invalid &&
              customerForm.get('shippingZoneId')?.touched) {
              <div class="invalid-feedback">Zone is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                Country <span class="text危険">*</span>
              </label>
              <select
                class="form-select"
                formControlName="shippingCountryId"
                [class.is-invalid]="
                  customerForm.get('shippingCountryId')?.invalid &&
                  customerForm.get('shippingCountryId')?.touched
                "
              >
                <option value="">Select Country</option>
                @for (country of shippingCountries; track country.id) {
                <option [value]="country.id">{{ country.name }}</option>
                }
              </select>
              @if (customerForm.get('shippingCountryId')?.invalid &&
              customerForm.get('shippingCountryId')?.touched) {
              <div class="invalid-feedback">Country is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                State <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="shippingStateId"
                [class.is-invalid]="
                  customerForm.get('shippingStateId')?.invalid &&
                  customerForm.get('shippingStateId')?.touched
                "
              >
                <option value="">Select State</option>
                @for (s of shippingStates; track s.id) {
                <option [value]="s.id">{{ s.name }}</option>
                }
              </select>
              @if (customerForm.get('shippingStateId')?.invalid &&
              customerForm.get('shippingStateId')?.touched) {
              <div class="invalid-feedback">State is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                City <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="shippingCityId"
                [class.is-invalid]="
                  customerForm.get('shippingCityId')?.invalid &&
                  customerForm.get('shippingCityId')?.touched
                "
              >
                <option value="">Select City</option>
                @for (c of shippingCities; track c.id) {
                <option [value]="c.id">{{ c.name }}</option>
                }
              </select>
              @if (customerForm.get('shippingCityId')?.invalid &&
              customerForm.get('shippingCityId')?.touched) {
              <div class="invalid-feedback">City is required</div>
              }
            </div>
          </div>
        </div>
      </nz-tab>
    </nz-tabset>
  </form>
</div>

<!-- =================== FOOTER SAVE BAR =================== -->
<div class="footer-bar" (click)="saveCustomer()">
  @if (!isLoading && customerForm.valid) {
  <span>
    <i class="bi {{ customerId ? 'bi-pencil-square' : 'bi-save' }} me-2"></i>
    {{ customerId ? "Update Customer" : "Save Customer" }}
  </span>
  } @if (isLoading) {
  <span>
    <span class="spinner-border spinner-border-sm me-2"></span>
    Saving...
  </span>
  } @if (customerForm.invalid && !isLoading) {
  <span class="opacity-75">
    <i class="bi bi-exclamation-triangle me-2"></i>
    Please fill all required fields
  </span>
  }
</div>
