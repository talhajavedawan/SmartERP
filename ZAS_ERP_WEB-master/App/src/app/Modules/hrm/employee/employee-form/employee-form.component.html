<div class="button-space">
  <!-- Close button -->
  <button
    type="button"
    class="btn-close close-button"
    aria-label="Close"
    (click)="closeModal()"
  ></button>

  <form [formGroup]="employeeForm">
    <nz-tabset [(nzSelectedIndex)]="selectedTabIndex">
      <!-- =================== PERSONAL INFORMATION =================== -->
      <nz-tab nzTitle="Personal Information">
        <div class="tab-content">
          <h5 class="section-title">
            <i class="bi bi-person-fill me-2 text-primary"></i> Personal
            Information
          </h5>

          <!-- =================== PROFILE PICTURE =================== -->
          <div class="text-center mb-4">
            <div
              class="profile-picture-container position-relative d-inline-block"
            >
              <!-- Main Image: Real or Default -->
              <img
                [src]="getProfileImageSrc()"
                alt="Profile Picture"
                class="rounded-circle border border-2 border-primary"
                width="120"
                height="120"
                style="object-fit: cover"
                (error)="onImageError()"
              />

              <!-- Camera Button -->
              <label
                class="btn btn-sm btn-outline-primary rounded-circle position-absolute bottom-0 end-0 translate-middle"
                style="width: 36px; height: 36px; line-height: 36px"
              >
                <input
                  type="file"
                  hidden
                  accept="image/*"
                  (change)="onProfilePictureChange($event)"
                />
                <i class="bi bi-camera-fill"></i>
              </label>

              <!-- Remove Button (only if real image exists) -->
              @if (employeeId && profilePictureUrl) {
              <button
                type="button"
                class="btn btn-sm btn-outline-danger rounded-circle position-absolute top-0 end-0 translate-middle"
                style="width: 32px; height: 32px; line-height: 32px"
                (click)="removeProfilePicture()"
              >
                <i class="bi bi-x"></i>
              </button>
              }
            </div>

            <div class="mt-2 small text-muted">
              Max 5 MB ¬∑ JPG, PNG, GIF, WEBP
            </div>
          </div>

          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">
                First Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="FirstName"
                placeholder="Enter First Name"
                [class.is-invalid]="
                  employeeForm.get('FirstName')?.invalid &&
                  employeeForm.get('FirstName')?.touched
                "
              />
              @if (employeeForm.get('FirstName')?.invalid &&
              employeeForm.get('FirstName')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid First Name
              </div>
              }
            </div>

            <div class="col-md-3">
              <label class="form-label">
                Last Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="LastName"
                placeholder="Enter Last Name"
                [class.is-invalid]="
                  employeeForm.get('LastName')?.invalid &&
                  employeeForm.get('LastName')?.touched
                "
              />
              @if (employeeForm.get('LastName')?.invalid &&
              employeeForm.get('LastName')?.touched) {
              <div class="invalid-feedback">Please enter a valid Last Name</div>
              }
            </div>

            <div class="col-md-3">
              <label class="form-label">
                Father's Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="FatherName"
                placeholder="Enter Father's Name"
                [class.is-invalid]="
                  employeeForm.get('FatherName')?.invalid &&
                  employeeForm.get('FatherName')?.touched
                "
              />
              @if (employeeForm.get('FatherName')?.invalid &&
              employeeForm.get('FatherName')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid Father's Name
              </div>
              }
            </div>

            <div class="col-md-3">
              <label class="form-label">
                CNIC <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="CNIC"
                placeholder="xxxxx-xxxxxxx-x"
                (input)="formatCnic($event)"
                [class.is-invalid]="
                  employeeForm.get('CNIC')?.invalid &&
                  employeeForm.get('CNIC')?.touched
                "
              />
              @if (employeeForm.get('CNIC')?.invalid &&
              employeeForm.get('CNIC')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid CNIC (e.g., xxxxx-xxxxxxx-x)
              </div>
              }
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-3">
              <label class="form-label">
                Gender <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="Gender"
                [class.is-invalid]="
                  employeeForm.get('Gender')?.invalid &&
                  employeeForm.get('Gender')?.touched
                "
              >
                <option value="">Select Gender</option>
                @for (g of genders; track g.name) {
                <option [value]="g.name">{{ g.name }}</option>
                }
              </select>
              @if (employeeForm.get('Gender')?.invalid &&
              employeeForm.get('Gender')?.touched) {
              <div class="invalid-feedback">Gender is required</div>
              }
            </div>

            <div class="col-md-3">
              <label class="form-label">
                Marital Status <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="MaritalStatus"
                [class.is-invalid]="
                  employeeForm.get('MaritalStatus')?.invalid &&
                  employeeForm.get('MaritalStatus')?.touched
                "
              >
                <option value="">Select Marital Status</option>
                @for (m of maritalStatuses; track m.name) {
                <option [value]="m.name">{{ m.name }}</option>
                }
              </select>
              @if (employeeForm.get('MaritalStatus')?.invalid &&
              employeeForm.get('MaritalStatus')?.touched) {
              <div class="invalid-feedback">Marital Status is required</div>
              }
            </div>

            <div class="col-md-3">
              <label class="form-label">
                Blood Group <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="BloodGroup"
                [class.is-invalid]="
                  employeeForm.get('BloodGroup')?.invalid &&
                  employeeForm.get('BloodGroup')?.touched
                "
              >
                <option value="">Select Blood Group</option>
                @for (b of bloodGroups; track b.name) {
                <option [value]="b.name">{{ b.name }}</option>
                }
              </select>
              @if (employeeForm.get('BloodGroup')?.invalid &&
              employeeForm.get('BloodGroup')?.touched) {
              <div class="invalid-feedback">Blood Group is required</div>
              }
            </div>

            <div class="col-md-3">
              <label class="form-label">
                Date of Birth <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                class="form-control"
                formControlName="DateOfBirth"
                [class.is-invalid]="
                  employeeForm.get('DateOfBirth')?.invalid &&
                  employeeForm.get('DateOfBirth')?.touched
                "
              />
              @if (employeeForm.get('DateOfBirth')?.invalid &&
              employeeForm.get('DateOfBirth')?.touched) {
              <div class="invalid-feedback">Date of Birth is required</div>
              }
            </div>
          </div>

          <div class="row g-3 mt-2">
            <div class="col-md-3">
              <label class="form-label">Passport Number</label>
              <input
                type="text"
                class="form-control"
                formControlName="PassportNumber"
                placeholder="Enter Passport Number"
              />
            </div>
            <!-- Nationality -->
            <div class="col-md-3">
              <label class="form-label">
                Nationality <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="Nationality"
                [class.is-invalid]="
                  employeeForm.get('Nationality')?.invalid &&
                  employeeForm.get('Nationality')?.touched
                "
              >
                <option value="">Select Nationality</option>
                @for (c of nationalities; track c.id) {
                <option [value]="c.name">{{ c.name }}</option>
                }
              </select>
              @if (employeeForm.get('Nationality')?.invalid &&
              employeeForm.get('Nationality')?.touched) {
              <div class="invalid-feedback">Nationality is required</div>
              }
            </div>

            <!-- Religion -->
            <div class="col-md-3">
              <label class="form-label">
                Religion <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="Religion"
                [class.is-invalid]="
                  employeeForm.get('Religion')?.invalid &&
                  employeeForm.get('Religion')?.touched
                "
              >
                <option value="">Select Religion</option>
                @for (r of religions; track r) {
                <option [value]="r">{{ r }}</option>
                }
              </select>
              @if (employeeForm.get('Religion')?.invalid &&
              employeeForm.get('Religion')?.touched) {
              <div class="invalid-feedback">Religion is required</div>
              }
            </div>
          </div>

          <h5 class="section-title mt-4">
            <i class="bi bi-telephone-fill me-2 text-primary"></i> Contact Info
          </h5>
          <div class="row g-4">
            <div class="col-md-3">
              <label class="form-label">
                Email <span class="text-danger">*</span>
              </label>
              <input
                type="email"
                class="form-control"
                formControlName="Email"
                placeholder="Enter Email"
                [class.is-invalid]="
                  employeeForm.get('Email')?.invalid &&
                  employeeForm.get('Email')?.touched
                "
              />
              @if (employeeForm.get('Email')?.invalid &&
              employeeForm.get('Email')?.touched) {
              <div class="invalid-feedback">Please enter a valid Email</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                Phone Number <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="PhoneNumber"
                placeholder="Enter Phone Number"
                [class.is-invalid]="
                  employeeForm.get('PhoneNumber')?.invalid &&
                  employeeForm.get('PhoneNumber')?.touched
                "
              />
              @if (employeeForm.get('PhoneNumber')?.invalid &&
              employeeForm.get('PhoneNumber')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid Phone Number
              </div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">Emergency Phone Number</label>
              <input
                type="text"
                class="form-control"
                formControlName="EmergencyPhoneNumber"
                placeholder="Enter Emergency Phone Number"
                [class.is-invalid]="
                  employeeForm.get('EmergencyPhoneNumber')?.invalid &&
                  employeeForm.get('EmergencyPhoneNumber')?.touched
                "
              />
              @if (employeeForm.get('EmergencyPhoneNumber')?.invalid &&
              employeeForm.get('EmergencyPhoneNumber')?.touched) {
              <div class="invalid-feedback">
                Please enter a valid Emergency Phone Number
              </div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">LinkedIn</label>
              <input
                type="text"
                class="form-control"
                formControlName="LinkedIn"
                placeholder="Enter LinkedIn"
              />
            </div>
          </div>
        </div>
      </nz-tab>

      <!-- =================== ADDRESS =================== -->
      <nz-tab nzTitle="Address">
        <div class="tab-content">
          <h5 class="section-title">
            <i class="bi bi-house-fill me-2 text-primary"></i> Permanent Address
          </h5>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">
                Address Line 1 <span class="text-danger">*</span>
              </label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="PermanentAddressLine1"
                [class.is-invalid]="
                  employeeForm.get('PermanentAddressLine1')?.invalid &&
                  employeeForm.get('PermanentAddressLine1')?.touched
                "
              ></textarea>
              @if (employeeForm.get('PermanentAddressLine1')?.invalid &&
              employeeForm.get('PermanentAddressLine1')?.touched) {
              <div class="invalid-feedback">
                Permanent Address Line 1 is required
              </div>
              }
            </div>
            <div class="col-md-4">
              <label class="form-label">Address Line 2</label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="PermanentAddressLine2"
              ></textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label">
                Zipcode <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="PermanentZipcode"
                placeholder="Enter Zipcode"
                [class.is-invalid]="
                  employeeForm.get('PermanentZipcode')?.invalid &&
                  employeeForm.get('PermanentZipcode')?.touched
                "
              />
              @if (employeeForm.get('PermanentZipcode')?.invalid &&
              employeeForm.get('PermanentZipcode')?.touched) {
              <div class="invalid-feedback">Please enter a valid Zipcode</div>
              }
            </div>
          </div>
          <div class="row g-3 mt-2">
            <div class="col-md-3">
              <label class="form-label">
                Zone <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="PermanentZoneId"
                [class.is-invalid]="
                  employeeForm.get('PermanentZoneId')?.invalid &&
                  employeeForm.get('PermanentZoneId')?.touched
                "
              >
                <option value="">Select Zone</option>
                @for (z of zones; track z.id) {
                <option [value]="z.id">{{ z.name }}</option>
                }
              </select>
              @if (employeeForm.get('PermanentZoneId')?.invalid &&
              employeeForm.get('PermanentZoneId')?.touched) {
              <div class="invalid-feedback">Zone is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                Country <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="PermanentCountryId"
                [class.is-invalid]="
                  employeeForm.get('PermanentCountryId')?.invalid &&
                  employeeForm.get('PermanentCountryId')?.touched
                "
              >
                <option value="">Select Country</option>
                @for (country of permanentCountries; track country.id) {
                <option [value]="country.id">{{ country.name }}</option>
                }
              </select>
              @if (employeeForm.get('PermanentCountryId')?.invalid &&
              employeeForm.get('PermanentCountryId')?.touched) {
              <div class="invalid-feedback">Country is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                State <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="PermanentStateId"
                [class.is-invalid]="
                  employeeForm.get('PermanentStateId')?.invalid &&
                  employeeForm.get('PermanentStateId')?.touched
                "
              >
                <option value="">Select State</option>
                @for (s of permanentStates; track s.id) {
                <option [value]="s.id">{{ s.name }}</option>
                }
              </select>
              @if (employeeForm.get('PermanentStateId')?.invalid &&
              employeeForm.get('PermanentStateId')?.touched) {
              <div class="invalid-feedback">State is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                City <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="PermanentCityId"
                [class.is-invalid]="
                  employeeForm.get('PermanentCityId')?.invalid &&
                  employeeForm.get('PermanentCityId')?.touched
                "
              >
                <option value="">Select City</option>
                @for (c of permanentCities; track c.id) {
                <option [value]="c.id">{{ c.name }}</option>
                }
              </select>
              @if (employeeForm.get('PermanentCityId')?.invalid &&
              employeeForm.get('PermanentCityId')?.touched) {
              <div class="invalid-feedback">City is required</div>
              }
            </div>
          </div>

          <h5 class="section-title mt-4">
            <i class="bi bi-house-door me-2 text-primary"></i> Temporary Address
          </h5>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Address Line 1</label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="TemporaryAddressLine1"
              ></textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label">Address Line 2</label>
              <textarea
                class="form-control"
                rows="1"
                formControlName="TemporaryAddressLine2"
              ></textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label">Zipcode</label>
              <input
                type="text"
                class="form-control"
                formControlName="TemporaryZipcode"
                placeholder="Enter Zipcode"
                [class.is-invalid]="
                  employeeForm.get('TemporaryZipcode')?.invalid &&
                  employeeForm.get('TemporaryZipcode')?.touched
                "
              />
              @if (employeeForm.get('TemporaryZipcode')?.invalid &&
              employeeForm.get('TemporaryZipcode')?.touched) {
              <div class="invalid-feedback">Please enter a valid Zipcode</div>
              }
            </div>
          </div>
          <div class="row g-3 mt-2">
            <div class="col-md-3">
              <label class="form-label">Zone</label>
              <select class="form-select" formControlName="TemporaryZoneId">
                <option value="">Select Zone</option>
                @for (z of zones; track z.id) {
                <option [value]="z.id">{{ z.name }}</option>
                }
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">Country</label>
              <select class="form-select" formControlName="TemporaryCountryId">
                <option value="">Select Country</option>
                @for (country of temporaryCountries; track country.id) {
                <option [value]="country.id">{{ country.name }}</option>
                }
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">State</label>
              <select class="form-select" formControlName="TemporaryStateId">
                <option value="">Select State</option>
                @for (s of temporaryStates; track s.id) {
                <option [value]="s.id">{{ s.name }}</option>
                }
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">City</label>
              <select class="form-select" formControlName="TemporaryCityId">
                <option value="">Select City</option>
                @for (c of temporaryCities; track c.id) {
                <option [value]="c.id">{{ c.name }}</option>
                }
              </select>
            </div>
          </div>
        </div>
      </nz-tab>

      <!-- =================== COMPANIES AND DEPARTMENTS =================== -->
      <nz-tab nzTitle="Companies and Departments">
        <div class="tab-fullscreen d-flex flex-column">
          <!-- ======== Top Half: Companies ======== -->
          <div class="flex-fill half-section">
            <div class="row g-4 h-100">
              <!-- Companies -->
              <div class="col-6 h-100">
                <div class="modern-card shadow-sm border-0 p-3 h-100">
                  <h6 class="fw-semibold mb-3 text-secondary">Companies</h6>
                  <input
                    type="text"
                    class="form-control form-control-modern mb-3"
                    placeholder="üîç Search companies..."
                    [value]="companySearch"
                    (input)="
                      companySearch = $any($event.target).value;
                      filterCompanies()
                    "
                  />
                  <ul
                    class="list-group modern-list flex-grow-1 overflow-auto h-100"
                  >
                    @for (company of filteredCompanies; track company.id) {
                    <li
                      class="list-group-item list-group-item-action modern-item"
                      (click)="addCompany(company)"
                    >
                      {{ company.companyName }}
                    </li>
                    } @if (filteredCompanies.length === 0) {
                    <li class="list-group-item text-muted text-center py-3">
                      No companies available
                    </li>
                    }
                  </ul>
                </div>
              </div>

              <!-- Selected Companies -->
              <div class="col-6 h-100">
                <div class="modern-card shadow-sm border-0 p-3 h-100">
                  <h6 class="fw-semibold mb-3 text-secondary">
                    Selected Companies
                  </h6>
                  <ul
                    class="list-group modern-list flex-grow-1 overflow-auto h-100"
                  >
                    @for (company of selectedCompanies; track company.id) {
                    <li
                      class="list-group-item d-flex justify-content-between align-items-center modern-item"
                    >
                      <span class="fw-medium">{{ company.companyName }}</span>
                      <button
                        class="btn btn-sm btn-outline-danger rounded-circle"
                        (click)="removeCompany(company, $event)"
                        type="button"
                        aria-label="Remove"
                      >
                        &times;
                      </button>
                    </li>
                    } @if (selectedCompanies.length === 0) {
                    <li class="list-group-item text-muted text-center py-3">
                      No companies selected
                    </li>
                    }
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- ======== Bottom Half: Departments ======== -->
          <div class="flex-fill half-section border-top pt-3">
            <div class="row g-4 h-100">
              <!-- Departments -->
              <div class="col-6 h-100">
                <div class="modern-card shadow-sm border-0 p-3 h-100">
                  <h6 class="fw-semibold mb-3 text-secondary">
                    Departments
                    <small class="text-muted"
                      >(filtered by selected companies)</small
                    >
                  </h6>
                  <input
                    type="text"
                    class="form-control form-control-modern mb-3"
                    placeholder="üîç Search departments..."
                    [value]="departmentSearch"
                    (input)="
                      departmentSearch = $any($event.target).value;
                      filterDepartments()
                    "
                  />
                  <ul
                    class="list-group modern-list flex-grow-1 overflow-auto h-100"
                  >
                    @for (department of filteredDepartments; track
                    department.id) {
                    <li
                      class="list-group-item list-group-item-action modern-item"
                      (click)="addDepartment(department)"
                    >
                      {{ department.deptName }}
                    </li>
                    } @if (filteredDepartments.length === 0) {
                    <li class="list-group-item text-muted text-center py-3">
                      No departments available
                      {{
                        selectedCompanies.length > 0
                          ? " for selected companies"
                          : ""
                      }}
                    </li>
                    }
                  </ul>
                </div>
              </div>

              <!-- Selected Departments -->
              <div class="col-6 h-100">
                <div class="modern-card shadow-sm border-0 p-3 h-100">
                  <h6 class="fw-semibold mb-3 text-secondary">
                    Selected Departments
                  </h6>
                  <ul
                    class="list-group modern-list flex-grow-1 overflow-auto h-100"
                  >
                    @for (department of selectedDepartments; track
                    department.id) {
                    <li
                      class="list-group-item d-flex justify-content-between align-items-center modern-item"
                    >
                      <span class="fw-medium">{{ department.deptName }}</span>
                      <button
                        class="btn btn-sm btn-outline-danger rounded-circle"
                        (click)="removeDepartment(department, $event)"
                        type="button"
                        aria-label="Remove"
                      >
                        &times;
                      </button>
                    </li>
                    } @if (selectedDepartments.length === 0) {
                    <li class="list-group-item text-muted text-center py-3">
                      No departments selected
                    </li>
                    }
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nz-tab>

      <!-- =================== EMPLOYEE DETAILS =================== -->
      <nz-tab nzTitle="Employee Details">
        <div class="tab-content">
          <h5 class="section-title">
            <i class="bi bi-card-text me-2 text-primary"></i> Basic Info
          </h5>
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">
                System Display Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="systemDisplayName"
                placeholder="Enter System Display Name"
                [class.is-invalid]="
                  employeeForm.get('systemDisplayName')?.invalid &&
                  employeeForm.get('systemDisplayName')?.touched
                "
              />
              @if (employeeForm.get('systemDisplayName')?.invalid &&
              employeeForm.get('systemDisplayName')?.touched) {
              <div class="invalid-feedback">
                System Display Name is required (Max 100 characters)
              </div>
              }
            </div>
            <!-- Job Title DropDown -->
            <div class="col-md-3">
              <label class="form-label"> Job Title </label>
              <select
                class="form-select"
                formControlName="jobTitle"
                [class.is-invalid]="
                  employeeForm.get('jobTitle')?.invalid &&
                  employeeForm.get('jobTitle')?.touched
                "
              >
                <option value="">Select Job Title</option>
                @for (jt of jobTitles; track jt.id) {
                <option [value]="jt.jobTitleName">{{ jt.jobTitleName }}</option>
                }
              </select>
            </div>
            <!-- Employee Status Dropdown -->
            <div class="col-md-3">
              <label class="form-label"
                >Employee Status <span class="text-danger">*</span></label
              >
              <select
                class="form-select"
                formControlName="employeeStatus"
                (change)="onEmployeeStatusChange($event)"
                [class.is-invalid]="
                  employeeForm.get('employeeStatus')?.invalid &&
                  employeeForm.get('employeeStatus')?.touched
                "
              >
                <option value="">Select Employee Status</option>
                @for (es of filteredEmployeeStatus; track es.id) {
                <option
                  [value]="es.statusName"
                  [style.color]="es.foreColor || 'inherit'"
                >
                  ‚óè {{ es.statusName }}
                </option>
                }
              </select>
            </div>

            <!-- Employee Status Class Dropdown -->
            <div class="col-md-3">
              <label class="form-label"
                >Status Class <span class="text-danger">*</span></label
              >
              <select
                class="form-select"
                formControlName="employeeStatusClass"
                [class.is-invalid]="
                  employeeForm.get('employeeStatusClass')?.invalid &&
                  employeeForm.get('employeeStatusClass')?.touched
                "
              >
                <option value="">Select Status Class</option>
                @for (sc of filteredStatusClasses; track sc.id) {
                <option
                  [value]="sc.className"
                  [style.color]="sc.foreColor || 'inherit'"
                >
                  ‚óè {{ sc.className }}
                </option>
                }
              </select>
            </div>

            <!-- Pay Grade -->
            <div class="col-md-3">
              <label class="form-label">Pay Grade</label>
              <input
                type="text"
                class="form-control"
                formControlName="payGrade"
                placeholder="Enter Pay Grade"
                [class.is-invalid]="
                  employeeForm.get('payGrade')?.invalid &&
                  employeeForm.get('payGrade')?.touched
                "
              />
              @if (employeeForm.get('payGrade')?.invalid &&
              employeeForm.get('payGrade')?.touched) {
              <div class="invalid-feedback">Maximum 50 characters allowed</div>
              }
            </div>
          </div>

          <h5 class="section-title mt-4">
            <i class="bi bi-briefcase-fill me-2 text-primary"></i> Employment
          </h5>
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">
                Employment Type <span class="text-danger">*</span>
              </label>
              <select
                class="form-select"
                formControlName="employmentType"
                [class.is-invalid]="
                  employeeForm.get('employmentType')?.invalid &&
                  employeeForm.get('employmentType')?.touched
                "
              >
                <option value="">Select</option>
                @for (t of employmentTypes; track t) {
                <option [value]="t">{{ t }}</option>
                }
              </select>
              @if (employeeForm.get('employmentType')?.invalid &&
              employeeForm.get('employmentType')?.touched) {
              <div class="invalid-feedback">
                Employment Type is required (Max 50 characters)
              </div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">
                Hire Date <span class="text-danger">*</span>
              </label>
              <input
                type="date"
                class="form-control"
                formControlName="hireDate"
                [class.is-invalid]="
                  employeeForm.get('hireDate')?.invalid &&
                  employeeForm.get('hireDate')?.touched
                "
              />
              @if (employeeForm.get('hireDate')?.invalid &&
              employeeForm.get('hireDate')?.touched) {
              <div class="invalid-feedback">Hire Date is required</div>
              }
            </div>
            <div class="col-md-3">
              <label class="form-label">Probation Period End</label>
              <input
                type="date"
                class="form-control"
                formControlName="probationPeriodEndDate"
              />
            </div>
            <div class="col-md-3">
              <label class="form-label">Termination Date</label>
              <input
                type="date"
                class="form-control"
                formControlName="terminationDate"
              />
            </div>
          </div>

          <h5 class="section-title mt-4">
            <i class="bi bi-gear-fill me-2 text-primary"></i> Management
          </h5>

          <div class="row g-3">
            <!-- MANAGER -->
            <div class="col-md-3">
              <label class="form-label">Manager</label>
              <select class="form-select" formControlName="managerId">
                <option [ngValue]="null">Select Manager</option>
                @for (e of filteredManagers; track e.id) {
                <option [ngValue]="e.id">
                  {{ e.systemDisplayName }}
                </option>
                }
              </select>
            </div>

            <!-- HR MANAGER -->
            <div class="col-md-3">
              <label class="form-label">HR Manager</label>
              <select class="form-select" formControlName="hrManagerId">
                <option [ngValue]="null">Select HR Manager</option>
                @for (e of filteredHrManagers; track e.id) {
                <option [ngValue]="e.id">
                  {{ e.systemDisplayName }}
                </option>
                }
              </select>
            </div>
          </div>
          <!-- Active Togle -->
          <div class="form-check mt-3">
            <div class="form-check form-switch">
              <input
                type="checkbox"
                class="form-check-input"
                formControlName="isActive"
                id="isActive"
              />
              <label for="isActive" class="form-check-label">Active</label>
            </div>
          </div>
        </div>
      </nz-tab>
    </nz-tabset>
  </form>
</div>

<!-- =================== FOOTER SAVE BAR =================== -->
<div class="footer-bar" (click)="saveEmployee()">
  @if (!isLoading && employeeForm.valid) {
  <span>
    <i class="bi {{ employeeId ? 'bi-pencil-square' : 'bi-save' }} me-2"></i>
    {{ employeeId ? "Update Employee" : "Save Employee" }}
  </span>
  } @if (isLoading) {
  <span>
    <span class="spinner-border spinner-border-sm me-2"></span>
    Saving...
  </span>
  } @if (employeeForm.invalid && !isLoading) {
  <span class="opacity-75">
    <i class="bi bi-exclamation-triangle me-2"></i>
    Please fill all required fields
  </span>
  }
</div>
